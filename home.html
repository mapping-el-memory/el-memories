<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>East Lansing – Chronological Slider Alternating</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>

    <style>
      html, body { height: 100%; margin: 0; }
      #myMap { width: 100%; height: 100%; }
      .leaflet-popup-content-wrapper { border-radius: 12px; box-shadow: 0 12px 28px rgba(0,0,0,.22); }
      .leaflet-popup-content h4 { margin: 0 0 4px 0; font-size: 16px; }
      .leaflet-popup-content p { margin: 0; font-size: 13px; color: #333; }
      .sliderctl { background:#fff; border:2px solid #18453B; border-radius:12px; padding:10px 12px; box-shadow:0 10px 24px rgba(0,0,0,.20); }
      .sliderctl .label { font-weight:700; color:#18453B; margin-bottom:6px; display:flex; align-items:center; gap:8px; }
      .sliderctl .date { font-weight:700; color:#18453B; }
      .sliderctl .ui-slider { width: 260px; margin-top:6px; }
    </style>
  </head>
  <body>
    <div id="myMap"></div>
    <script>
      var map1 = L.map('myMap').setView([42.7348, -84.4820], 13);
      L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      }).addTo(map1);

      function featurePt(title, lon, lat, time, desc){
        return {
          type: 'Feature',
          geometry: { type: 'Point', coordinates: [ lon, lat ] },
          properties: { title: title, description: desc || '', time: time }
        };
      }

      var dataset1 = [
        featurePt('Gungun — Baker Hall', -84.47389, 42.72917, '2023/09', 'Baker Hall (source: topoquest.com)'),
        featurePt('Kiera — IM West', -84.487943, 42.728184, '2024/09', 'IM West (spartancash.msu.edu)'),
        featurePt('Ritesh — Wells Hall', -84.48194, 42.72778, '2023/09', 'Wells Hall (source: LatLong)'),
        featurePt('Gungun — Potbelly (233 E Grand River Ave)', -84.48174, 42.73489, '2023/09', 'Potbelly (source: MapQuest)'),
        featurePt('Kiera — MSU Dairy Store (Anthony Hall, 474 S Shaw Ln)', -84.479515, 42.725117, '2024/09', 'MSU Dairy Store (whereorg.com)'),
        featurePt('Ritesh — Olga’s Kitchen (Frandor, 354 Frandor Ave)', -84.52883, 42.73587, '2023/09', 'Olga’s Kitchen – Frandor'),
        featurePt('Gungun — Meijer (1350 W Lake Lansing Rd)', -84.50445, 42.768278, '2023/09', 'Meijer – Lake Lansing (maps.msu.edu)'),
        featurePt('Kiera — Main Library (366 W Circle Dr)', -84.483208, 42.730869, '2024/09', 'Main Library (LatLong)'),
        featurePt('Ritesh — Staples (3003 E Michigan Ave)', -84.52633, 42.73479, '2023/09', 'Staples (stores.staples.com)'),
        featurePt('Gungun — Sansu (4750 S Hagadorn Rd)', -84.482842, 42.702165, '2023/09', 'Sansu (Yelp)'),
        featurePt('Kiera — Brody Square', -84.49543, 42.73149, '2024/09', 'Brody Square (Mapcarta)'),
        featurePt('Ritesh — Summit Comics & Games (216 S Washington Sq)', -84.551557, 42.734973, '2023/09', 'Summit Comics & Games (downtownlansing.org)'),
        featurePt('Gungun — Jolly Pumpkin (218 Albert Ave)', -84.48253, 42.73586, '2023/09', 'Jolly Pumpkin (MapQuest)'),
        featurePt('Kiera — Erickson Hall', -84.47928, 42.72708, '2024/09', 'Erickson Hall (Mapcarta)'),
        featurePt('Ritesh — MSU Tech Store (Computer Center, 450 Auditorium Rd)', -84.47899, 42.72529, '2023/09', 'MSU Tech Store (maps.msu.edu)')
      ];

      function onEachFeature(feature, layer){
        var content = <div><h4>${feature.properties.title}</h4><p>${feature.properties.description}</p></div>;
        layer.bindPopup(content);
      }

      var group1 = L.geoJSON(dataset1, { onEachFeature: onEachFeature });
      var entries = [];
      group1.eachLayer(function(layer){
        var t = layer.feature.properties.time;
        var parts = t.split('/');
        var d = new Date(parseInt(parts[0]), parseInt(parts[1])-1, 1);
        entries.push({layer: layer, time: d});
      });

      var tmpGroup = L.featureGroup(entries.map(e=>e.layer));
      var b = tmpGroup.getBounds();
      if (b.isValid()) map1.fitBounds(b.pad(0.15));

      (function(){
        var SliderCtl = L.Control.extend({
          options: {position: 'bottomleft', alwaysShowDate: true, showPopups: true},
          onAdd: function(map){
            this._map = map;
            var div = L.DomUtil.create('div', 'sliderctl');
            div.innerHTML = '<div class="label"><span class="date" id="slider-date"></span></div><div id="slider-ui"></div>';
            L.DomEvent.disableClickPropagation(div);
            return div;
          },
          startSlider: function(){
            var that = this;
            var $ui = $('#slider-ui');
            var $date = $('#slider-date');
            $ui.slider({min:0,max:entries.length-1,value:0,step:1,slide:(e,ui)=>that._update(ui.value),change:(e,ui)=>that._update(ui.value)});
            this._update(0);
          },
          _update: function(i){
            var e = entries[i];
            if(!e) return;
            if(this.current) try{this._current.layer.remove();}catch(){ }
            e.layer.addTo(this._map);
            e.layer.openPopup();
            $('#slider-date').text(e.time.getFullYear());
            this._current = e;
            var latlng = e.layer.getLatLng?.();
            if(latlng) this._map.panTo(latlng,{animate:true});
          }
        });
        L.control.sliderControl = opts=>new SliderCtl(opts);
      })();

      var sliderControl1 = L.control.sliderControl({layer:group1});
      map1.addControl(sliderControl1);
      sliderControl1.startSlider();
    </script>
  </body>
</html>